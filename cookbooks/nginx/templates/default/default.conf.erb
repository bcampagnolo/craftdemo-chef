server {
    listen       <%= node[:nginx][:listenPort] %>;
    server_name  localhost;
    listen 443 <%= node[:nginx][:protocol_support_443] %>;
    ssl_certificate        <%= node[:nginx][:sslCert] %>;
    ssl_certificate_key    <%= node[:nginx][:sslKey] %>;
    ssl_protocols          <%= node[:nginx][:sslProtocols] %>;
    ssl_ciphers            <%= node[:nginx][:sslCiphers] %>;
    ssl_prefer_server_ciphers on;

    if ($ssl_protocol = "") {
        rewrite ^ https://$host$request_uri? permanent;
    }

    location / {
      index <%= node[:nginx][:indexFile] %>;
      root <%= node[:nginx][:docRoot] %>;
      error_page <%= node[:nginx][:errorPage01] %>;

    #Apache like server status... just not quite as good as apache's
    location /server-status {
       stub_status;
       allow 127.0.0.1;
       deny all;
    }

    ###
    # node[:nginx][:proxyPass] = [ { "site" => "/proxied/deploy", "remote" => "https://.../" } ]
    ##
    <% if node[:nginx][:proxyPass] -%>
    <% node[:nginx][:proxyPass].each do |i| %>
    location <%= i.site %> {
        proxy_pass <%= i.remote %>;
    }
    <% end -%>
    <% end -%>

}
